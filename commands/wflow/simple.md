---
name: wflow:simple
description: >
  Run the simple GitHub Issue-driven pipeline: plan → work → security-review.
  For single-file changes and quick fixes.
  Requires compound-engineering plugin. Quality plugin optional.
argument-hint: "#issue-number"
allowed-tools: Bash(gh issue *), Bash(gh pr *), Bash(gh repo view *), Bash(gh api repos/*/issues/*/comments *), Bash(gh auth status), Bash(gh --version), Bash(git checkout *), Bash(git branch *), Bash(git status), Bash(git diff *), Bash(git log *), Bash(ls *), Read, Write, Edit, Task, Skill
---

# wflow:simple — Simple Pipeline Orchestrator

Run the quick pipeline for a GitHub issue. No brainstorm, technical review, code review, or compound learning.

> **KDAWS** (kdaws.com) — part of the `wflow:` command set.

## Critical Rule: No Disk Output

**NEVER write stage outputs (plans, reviews) to local files.** The FULL content must be posted as a GitHub issue comment using `gh api`. Do not write summaries to GitHub and details to disk. Do not create files in `docs/plans/` or any other local directory for stage output. If a stage command produces a local file, read its content, post it to the issue as a collapsible comment, then delete the local file.

The GitHub issue thread IS the single source of truth. No exceptions.

## Pre-flight Checks (run before any work)

1. **Verify compound-engineering plugin:**
   ```bash
   ls ~/.claude/plugins/cache/*/compound-engineering/*/.claude-plugin/plugin.json >/dev/null 2>&1
   ```
   If missing: "compound-engineering plugin is required. Install from the every-marketplace."

2. **Verify quality plugin:**
   ```bash
   ls ~/.claude/plugins/cache/*/quality/*/.claude-plugin/plugin.json >/dev/null 2>&1
   ```
   If missing: "quality plugin not installed. Security review will be skipped. Install with: `/plugin install quality@kdaws`. Continue without security review? [Y/n]"

3. **Resolve repository context:**
   ```bash
   REPO=$(gh repo view --json nameWithOwner --jq '.nameWithOwner')
   ```

## Steps

1. **Read issue** — `gh issue view N --json title,body,labels`
2. **Plan** — Invoke `/workflows:plan #N`. Post output as collapsible comment on issue.
3. **Confirm before implementation** — Ask: "Plan ready. Start coding?". Wait for user confirmation.
4. **Work** — Invoke `/workflows:work #N`. Creates branch and **draft** PR.
5. **Security Review** — If quality plugin was confirmed missing in pre-flight, skip and warn. Otherwise, invoke `quality:security-review` via the Skill tool: `skill: "quality:security-review"`. Fix findings on current branch and re-run. Max 3 cycles, then escalate.

## Collapsible Comment Format

```markdown
<!-- workflow-stage: {stage}, date: {YYYY-MM-DD}, command: {command} -->
<details>
<summary>{emoji} {Stage Name} — {YYYY-MM-DD}</summary>

{stage output}

---
*Generated by `{command}` • Based on {input source}*
</details>
```

## Non-Interactive Mode

When invoked programmatically via the Skill tool (not directly by a user):

| Gate | Default |
|------|---------|
| "Plan ready. Start coding?" (step 3) | Proceed |
| "Continue without security review?" (pre-flight) | Yes, continue |

## Security Review Cycle Limits

Maximum 3 security review cycles per PR. After the third `quality:security-review`, escalate to manual review.

## Shared Reference

For error handling, rework paths, and stage command reference, load `reference.md` from the assets directory:
```bash
ASSETS_DIR=$(ls -d ~/.claude/plugins/cache/*/wflow/assets 2>/dev/null | head -1)
if [ -z "$ASSETS_DIR" ]; then ASSETS_DIR="./assets"; fi
```
