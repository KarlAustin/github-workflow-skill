---
name: wflow:full
description: >
  Run the full GitHub Issue-driven pipeline: brainstorm → plan → (deepen?) →
  technical review → work → review → security-review → compound.
  Requires compound-engineering and quality plugins.
argument-hint: "#issue-number"
allowed-tools: Bash(gh issue *), Bash(gh pr *), Bash(gh label *), Bash(gh repo view *), Bash(gh api repos/*/issues/*/comments *), Bash(gh auth status), Bash(gh --version), Bash(git checkout *), Bash(git branch *), Bash(git status), Bash(git diff *), Bash(git log *), Bash(ls *), Read, Write, Edit, Task, Skill
---

# wflow:full — Full Pipeline Orchestrator

Run the complete pipeline for a GitHub issue. Every stage posts its output as a collapsible comment on the issue thread.

> **KDAWS** (kdaws.com) — part of the `wflow:` command set.

## Pre-flight Checks (run before any work)

1. **Verify compound-engineering plugin:**
   ```bash
   ls ~/.claude/plugins/cache/*/compound-engineering/*/.claude-plugin/plugin.json >/dev/null 2>&1
   ```
   If missing: "compound-engineering plugin is required. Install from the every-marketplace."

2. **Verify quality plugin:**
   ```bash
   ls ~/.claude/plugins/cache/*/quality/*/.claude-plugin/plugin.json >/dev/null 2>&1
   ```
   If missing: "quality plugin not installed. Security review will be skipped. Install with: `/plugin install quality@kdaws`. Continue without security review? [Y/n]"

3. **Resolve repository context:**
   ```bash
   REPO=$(gh repo view --json nameWithOwner --jq '.nameWithOwner')
   ```

## Steps

1. **Read issue** — `gh issue view N --json title,body,labels`
2. **Brainstorm** — Invoke `/workflows:brainstorm #N`. Post output as collapsible comment on issue.
3. **Plan** — Invoke `/workflows:plan #N`. Post output as collapsible comment on issue.
4. **Deepen plan (optional)** — Ask: "Deepen this plan with parallel research? (recommended for complex features)". If yes, invoke `/deepen-plan` on the plan file, then post the deepened plan as a new collapsible comment.
5. **Technical review** — Invoke `/technical_review #N`. Post output as collapsible comment on issue.
6. **Confirm before implementation** — Ask: "Plan reviewed. Ready to start coding?". Wait for user confirmation.
7. **Work** — Invoke `/workflows:work #N`. Creates branch and **draft** PR.
8. **Review** — Convert to ready-for-review via `gh pr ready`, then invoke `/workflows:review`. Posts review comments on PR.
9. **Resolve fixes** — If review has findings, load `reference.md` from the assets directory for rework paths.
10. **Security Review** — If quality plugin was confirmed missing in pre-flight, skip and warn. Otherwise, invoke `quality:security-review` via the Skill tool: `skill: "quality:security-review"`. If blocking findings, fix on current branch and re-run. Max 3 cycles, then escalate to manual review.
11. **Compound** — After merge, invoke `/workflows:compound #N`. Documents lessons learned.

## Between Stages

- Post each stage's output to the GitHub issue as a collapsible comment (see skill's SKILL.md for format). Exception: `quality:security-review` posts to the PR.
- The issue thread is the shared context — each stage reads prior outputs from GitHub.
- User can stop the pipeline at any point by saying "stop" or "pause".
- If any stage fails, stop and report the error.

## Collapsible Comment Format

```markdown
<!-- workflow-stage: {stage}, date: {YYYY-MM-DD}, command: {command} -->
<details>
<summary>{emoji} {Stage Name} — {YYYY-MM-DD}</summary>

{stage output}

---
*Generated by `{command}` • Based on {input source}*
</details>
```

## Non-Interactive Mode

When invoked programmatically via the Skill tool (not directly by a user), use these defaults:

| Gate | Default |
|------|---------|
| "Deepen this plan?" (step 4) | Skip |
| "Ready to start coding?" (step 6) | Proceed |
| "Continue without security review?" (pre-flight) | Yes, continue |

## Review Cycle Limits

Maximum 2 review cycles per PR. After the second `/workflows:review`:

```
This PR has been reviewed twice. Options:
  1. Merge as-is
  2. Close PR and rework from plan stage
  3. Run one more review (not recommended)
```

## Security Review Cycle Limits

Maximum 3 security review cycles per PR. After the third `quality:security-review`:

```
Security review has failed 3 times. Remaining findings need manual review:
  1. [finding]
  2. [finding]
Fix these manually or confirm as false positives before merging.
```

## Shared Reference

For error handling, rework paths, and stage command reference, load `reference.md` from the assets directory:
```bash
ASSETS_DIR=$(ls -d ~/.claude/plugins/cache/*/wflow/assets 2>/dev/null | head -1)
if [ -z "$ASSETS_DIR" ]; then ASSETS_DIR="./assets"; fi
```
